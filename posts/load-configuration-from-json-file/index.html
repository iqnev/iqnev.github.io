<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Liste - https://iqnev.github.io/">
    <title>Creating Custom Configuration in Quarkus Loaded from JSON File | Codes are a puzzle</title>
    <meta name="description" content="A minimal hugo theme focus on content">
    <meta property="og:title" content="Creating Custom Configuration in Quarkus Loaded from JSON File" />
<meta property="og:description" content="Introduction Quarkus, a framework for building lightweight, fast, and efficient Java applications, offers developers the flexibility to create custom configurations loaded from JSON files. These custom configurations can be seamlessly integrated into your Quarkus application, enhancing its configurability and adaptability. To achieve this, Quarkus utilizes Eclipse MicroProfile Config ( MP-Config), with the SmallRye implementation providing the necessary tools. In this article, we&rsquo;ll delve into the process of crafting custom configurations and loading them from JSON files within Quarkus, all while exploring the mechanics of SmallRye&rsquo;s MP-Config implementation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://iqnev.github.io/posts/load-configuration-from-json-file/" /><meta property="og:image" content="https://iqnev.github.io/images/quarkus_blogpost_formallogo.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-14T21:00:18+03:00" />
<meta property="article:modified_time" content="2023-10-14T21:00:18+03:00" />


    <meta itemprop="name" content="Creating Custom Configuration in Quarkus Loaded from JSON File">
<meta itemprop="description" content="Introduction Quarkus, a framework for building lightweight, fast, and efficient Java applications, offers developers the flexibility to create custom configurations loaded from JSON files. These custom configurations can be seamlessly integrated into your Quarkus application, enhancing its configurability and adaptability. To achieve this, Quarkus utilizes Eclipse MicroProfile Config ( MP-Config), with the SmallRye implementation providing the necessary tools. In this article, we&rsquo;ll delve into the process of crafting custom configurations and loading them from JSON files within Quarkus, all while exploring the mechanics of SmallRye&rsquo;s MP-Config implementation."><meta itemprop="datePublished" content="2023-10-14T21:00:18+03:00" />
<meta itemprop="dateModified" content="2023-10-14T21:00:18+03:00" />
<meta itemprop="wordCount" content="1010"><meta itemprop="image" content="https://iqnev.github.io/images/quarkus_blogpost_formallogo.png">
<meta itemprop="keywords" content="Development,Quarkus,MicroProfile,JSON," />
    
    <link rel="canonical" href="https://iqnev.github.io/posts/load-configuration-from-json-file/">
    <link rel="icon" href="https://iqnev.github.io//assets/favicon.ico">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link href="https://www.google-analytics.com" rel="preconnect" crossorigin>
    <link rel="alternate" type="application/atom+xml" title="Codes are a puzzle" href="https://iqnev.github.io//atom.xml" />
    <link rel="alternate" type="application/json" title="Codes are a puzzle" href="https://iqnev.github.io//feed.json" />
    <link rel="shortcut icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNk+A8AAQUBAScY42YAAAAASUVORK5CYII=">
    
    
    <style>*,:after,:before{box-sizing:border-box;padding:0}body{font:1rem/1.5 '-apple-system',BlinkMacSystemFont,avenir next,avenir,helvetica,helvetica neue,ubuntu,roboto,noto,segoe ui,arial,sans-serif;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:2rem;background:#f5f5f5;color:#000}.skip-link{position:absolute;top:-40px;left:0;background:#eee;z-index:100}.skip-link:focus{top:0}h1,h2,h3,h4,h5,strong,b{font-size:inherit;font-weight:600}header{line-height:2;padding-bottom:1.5rem}.link{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.time{font-variant-numeric:tabular-nums;white-space:nowrap}blockquote{border-left:5px solid #eee;padding-left:1rem;margin:0}a,a:visited{color:inherit}a:hover,a.heading-link{text-decoration:none}pre{padding:.5rem;overflow:auto;overflow-x:scroll;overflow-wrap:normal}code,pre{font-family:San Francisco Mono,Monaco,consolas,lucida console,dejavu sans mono,bitstream vera sans mono,monospace;font-size:normal;font-size:small;background:#eee}code{margin:.1rem;border:none}ul{list-style-type:square}ul,ol{padding-left:1.2rem}.list{line-height:2;list-style-type:none;padding-left:0}.list li{padding-bottom:.1rem}.meta{color:#777}.content{max-width:70ch;margin:0 auto}header{line-height:2;display:flex;justify-content:space-between;padding-bottom:1rem}header a{text-decoration:none}header ul{list-style-type:none;padding:0}header li,header a{display:inline}h2.post{padding-top:.5rem}header ul a:first-child{padding-left:1rem}.nav{height:1px;background:#000;content:'';max-width:10%}.list li{display:flex;align-items:baseline}.list li time{flex:initial}.hr-list{margin-top:0;margin-bottom:0;margin-right:.5rem;margin-left:.5rem;height:1px;border:0;border-bottom:1px dotted #ccc;flex:1 0 1rem}.m,hr{border:0;margin:3rem 0}img{max-width:100%;height:auto}.post-date{margin:5% 0}.index-date{color:#9a9a9a}.animate-blink{animation:opacity 1s infinite;opacity:1}@keyframes opacity{0%{opacity:1}50%{opacity:.5}100%{opacity:0}}.tags{display:flex;justify-content:space-between}.tags ul{padding:0;margin:0}.tags li{display:inline}.avatar{height:120px;width:120px;position:relative;margin:-10px 0 0 15px;float:right;border-radius:50%} </style>
  
    
  
  
  <script type="application/ld+json">
  {
      "@context": "http://schema.org",
      "@type": "BlogPosting",
      "articleSection": "posts",
      "name": "Creating Custom Configuration in Quarkus Loaded from JSON File",
      "headline": "Creating Custom Configuration in Quarkus Loaded from JSON File",
      "alternativeHeadline": "",
      "description": "Introduction Quarkus, a framework for building lightweight, fast, and efficient Java applications, offers developers the flexibility to create custom configurations loaded from JSON files. These custom configurations can be seamlessly integrated into your Quarkus application, enhancing its configurability and adaptability. To achieve this, Quarkus utilizes Eclipse MicroProfile Config ( MP-Config), with the SmallRye implementation providing the necessary tools. In this article, we\u0026rsquo;ll delve into the process of crafting custom configurations and loading them from JSON files within Quarkus, all while exploring the mechanics of SmallRye\u0026rsquo;s MP-Config implementation.",
      "inLanguage": "en-us",
      "isFamilyFriendly": "true",
      "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https:\/\/iqnev.github.io\/posts\/load-configuration-from-json-file\/"
      },
      "author" : {
          "@type": "Person",
          "name": ""
      },
      "creator" : {
          "@type": "Person",
          "name": ""
      },
      "accountablePerson" : {
          "@type": "Person",
          "name": ""
      },
      "copyrightHolder" : "Codes are a puzzle",
      "copyrightYear" : "2023",
      "dateCreated": "2023-10-14T21:00:18.00Z",
      "datePublished": "2023-10-14T21:00:18.00Z",
      "dateModified": "2023-10-14T21:00:18.00Z",
      "publisher":{
          "@type":"Organization",
          "name": "Codes are a puzzle",
          "url": "https://iqnev.github.io/",
          "logo": {
              "@type": "ImageObject",
              "url": "https:\/\/iqnev.github.io\/images\/favicon.ico",
              "width":"32",
              "height":"32"
          }
      },
      "image": ["https://iqnev.github.io/images/quarkus_blogpost_formallogo.png"],
      "url" : "https:\/\/iqnev.github.io\/posts\/load-configuration-from-json-file\/",
      "wordCount" : "1010",
      "genre" : [ "Development" , "Quarkus" , "MicroProfile" , "JSON" ],
      "keywords" : [ "Development" , "Quarkus" , "MicroProfile" , "JSON" ]
  }
  </script>
  
  
  </head>

<body>
  <a class="skip-link" href="#main">Skip to main</a>
  <main id="main">
  <div class="content">
    <header>
<p style="padding: 0;margin: 0;">
  <a href="/">
    <b>Codes are a puzzle</b>
    <span class="text-stone-500 animate-blink">â–®</span>
  </a>
</p>
<ul style="padding: 0;margin: 0;">
  
  
  <li class="">
    <a href="/about/"><span>About</span></a>
    
  <li class="">
    <a href="/posts/"><span>Posts</span></a>
    
  <li class="">
    <a href="/categories/"><span>Categories</span></a>
    
  </li>
</ul>
</header>
<hr class="hr-list" style="padding: 0;margin: 0;">
    <section>
      <h2 class="post">Creating Custom Configuration in Quarkus Loaded from JSON File</h2>
      <h3 id="introduction">Introduction</h3>
<p>Quarkus, a framework for building lightweight, fast, and efficient Java applications, offers
developers the flexibility to create custom configurations loaded from JSON files. These custom
configurations can be seamlessly integrated into your Quarkus application, enhancing its
configurability and adaptability. To achieve this, Quarkus utilizes Eclipse MicroProfile Config (
MP-Config), with the SmallRye implementation providing the necessary tools. In this article, we&rsquo;ll
delve into the process of crafting custom configurations and loading them from JSON files within
Quarkus, all while exploring the mechanics of SmallRye&rsquo;s MP-Config implementation. Additionally,
we&rsquo;ll showcase the creation and registration of a custom ConfigSource and ConfigSourceFactory, which
play a pivotal role in this configuration management approach.</p>
<h3 id="understanding-microprofile-config-in-quarkus">Understanding MicroProfile Config in Quarkus</h3>
<p>Quarkus internally relies on the SmallRye implementation of MP-Config. This implementation allows
developers to incorporate Configuration Sources, which provide configuration data from various
origins. These sources can be files with non-standard formats, or even data retrieved from a central
repository. MP-Config ensures a deterministic ordering of configuration sources based on their
ordinal values when multiple sources contain the same configuration key.</p>
<p>SmallRye&rsquo;s implementation of MP-Config facilitates the creation of new ConfigSources and
ConfigSourceFactories. The ConfigSourceFactory has knowledge of all previously defined sources,
enabling developers to read those values and pass them to a newly created ConfigSource. The
registration of these custom sources and factories is accomplished through the Java ServiceLoader
interface, with a specific file called <code>io.smallrye.config.ConfigSourceFactory</code> being placed in the
<code>META-INF/services/</code> directory. This file provides the fully qualified names of the custom sources
and
factories.</p>
<h3 id="implementing-a-custom-json-configuration">Implementing a custom JSON Configuration</h3>
<p>To demonstrate the creation and registration of a custom <code>ConfigSource</code> and <code>ConfigSourceFactory</code> in
Quarkus, we&rsquo;ll focus on a practical example - an <code>JsonConfigSource</code> and <code>JsonConfigSourceFactory</code>
pair.
This custom configuration source allows you to read external JSON configuration files and integrate
them into your Quarkus application.</p>
<p>The <code>JsonConfigSource</code> class is responsible for reading and providing configuration properties from
a JSON file. It implements the <code>ConfigSource</code> interface and overrides several methods to interact
with
the Quarkus configuration system.</p>
<p>Here is an overview of its key functionalities:</p>
<ul>
<li>Reading a JSON file and parsing it into a JsonObject.</li>
<li>Providing configuration properties, including handling default values.</li>
<li>Specifying the source&rsquo;s ordinal value.</li>
<li>Assigning a unique name to the source, which will be used for registration.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">JsonConfigSource</span> <span style="color:#8be9fd;font-style:italic">implements</span> ConfigSource {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">final</span> Map<span style="color:#ff79c6">&lt;</span>String, ConfigValue<span style="color:#ff79c6">&gt;</span> existingValues;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">private</span> JsonObject root;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">JsonConfigSource</span>(<span style="color:#8be9fd;font-style:italic">final</span> Map<span style="color:#ff79c6">&lt;</span>String, ConfigValue<span style="color:#ff79c6">&gt;</span> exProp) {
</span></span><span style="display:flex;"><span>    existingValues <span style="color:#ff79c6">=</span> exProp;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">addJsonConfigurations</span>(<span style="color:#8be9fd;font-style:italic">final</span> ConfigValue config) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> File file <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> File(config.<span style="color:#50fa7b">getValue</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>file.<span style="color:#50fa7b">canRead</span>()) {
</span></span><span style="display:flex;"><span>      log.<span style="color:#50fa7b">warn</span>(<span style="color:#f1fa8c">&#34;Can&#39;t read config from &#34;</span> <span style="color:#ff79c6">+</span> file.<span style="color:#50fa7b">getAbsolutePath</span>() <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">try</span> (<span style="color:#8be9fd;font-style:italic">final</span> InputStream fis <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> FileInputStream(file);
</span></span><span style="display:flex;"><span>          <span style="color:#8be9fd;font-style:italic">final</span> JsonReader reader <span style="color:#ff79c6">=</span> Json.<span style="color:#50fa7b">createReader</span>(fis)) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        root <span style="color:#ff79c6">=</span> reader.<span style="color:#50fa7b">readObject</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#ff79c6">catch</span> (<span style="color:#8be9fd;font-style:italic">final</span> IOException ioe) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#50fa7b">warn</span>(<span style="color:#f1fa8c">&#34;Reading the config failed: &#34;</span> <span style="color:#ff79c6">+</span> ioe.<span style="color:#50fa7b">getMessage</span>());
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getProperties</span>() {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> Map<span style="color:#ff79c6">&lt;</span>String, String<span style="color:#ff79c6">&gt;</span> props <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HashMap<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> Set<span style="color:#ff79c6">&lt;</span>Map.<span style="color:#50fa7b">Entry</span><span style="color:#ff79c6">&lt;</span>String, ConfigValue<span style="color:#ff79c6">&gt;&gt;</span> entries <span style="color:#ff79c6">=</span> existingValues.<span style="color:#50fa7b">entrySet</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">final</span> Map.<span style="color:#50fa7b">Entry</span><span style="color:#ff79c6">&lt;</span>String, ConfigValue<span style="color:#ff79c6">&gt;</span> entry : entries) {
</span></span><span style="display:flex;"><span>      String newVal <span style="color:#ff79c6">=</span> getValue(entry.<span style="color:#50fa7b">getKey</span>());
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (newVal <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>        newVal <span style="color:#ff79c6">=</span> entry.<span style="color:#50fa7b">getValue</span>().<span style="color:#50fa7b">getValue</span>();
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      props.<span style="color:#50fa7b">put</span>(entry.<span style="color:#50fa7b">getKey</span>(), newVal);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> props;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> Set<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getPropertyNames</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> existingValues.<span style="color:#50fa7b">keySet</span>();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">int</span> <span style="color:#50fa7b">getOrdinal</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> 270;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getValue</span>(<span style="color:#8be9fd;font-style:italic">final</span> String configKey) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> JsonValue jsonValue <span style="color:#ff79c6">=</span> root.<span style="color:#50fa7b">get</span>(configKey);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (jsonValue <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> getStringValue(jsonValue);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (existingValues.<span style="color:#50fa7b">containsKey</span>(configKey)) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> existingValues.<span style="color:#50fa7b">get</span>(configKey).<span style="color:#50fa7b">getValue</span>();
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getName</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;EXTERNAL_JSON&#34;</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">private</span> String <span style="color:#50fa7b">getStringValue</span>(<span style="color:#8be9fd;font-style:italic">final</span> JsonValue jsonValue) {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (jsonValue <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">final</span> JsonValue.<span style="color:#50fa7b">ValueType</span> valueType <span style="color:#ff79c6">=</span> jsonValue.<span style="color:#50fa7b">getValueType</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (valueType <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">STRING</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> ((JsonString) jsonValue).<span style="color:#50fa7b">getString</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (valueType <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">NUMBER</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Handle integer and floating-point numbers</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> jsonValue.<span style="color:#50fa7b">toString</span>();
</span></span><span style="display:flex;"><span>      } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (valueType <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">TRUE</span> <span style="color:#ff79c6">||</span> valueType <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">FALSE</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Handle boolean values</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> Boolean.<span style="color:#50fa7b">toString</span>(jsonValue.<span style="color:#50fa7b">getValueType</span>() <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">TRUE</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (valueType <span style="color:#ff79c6">==</span> JsonValue.<span style="color:#50fa7b">ValueType</span>.<span style="color:#50fa7b">NULL</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Handle null values</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>JsonConfigSourceFactory</code> class is a custom <code>ConfigSourceFactory</code> responsible for creating and
configuring instances of the <code>JsonConfigSource</code>. It also defines a unique priority for this factory.</p>
<p>Here is an overview of its key functionalities:</p>
<ul>
<li>Retrieving the path of the JSON configuration file from the Quarkus configuration.</li>
<li>Building an instance of JsonConfigSource.</li>
<li>Assigning a priority value to the factory.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Slf4j
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">JsonConfigSourceFactory</span> <span style="color:#8be9fd;font-style:italic">implements</span> ConfigSourceFactory {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">final</span> String CONFIG_JSON_FILE <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;config.json.file&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> Iterable<span style="color:#ff79c6">&lt;</span>ConfigSource<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getConfigSources</span>(<span style="color:#8be9fd;font-style:italic">final</span> ConfigSourceContext configSourceContext) {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> ConfigValue value <span style="color:#ff79c6">=</span> configSourceContext.<span style="color:#50fa7b">getValue</span>(CONFIG_JSON_FILE);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (value <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">||</span> value.<span style="color:#50fa7b">getValue</span>() <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> Collections.<span style="color:#50fa7b">emptyList</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> Map<span style="color:#ff79c6">&lt;</span>String, ConfigValue<span style="color:#ff79c6">&gt;</span> exProp <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> HashMap<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> Iterator<span style="color:#ff79c6">&lt;</span>String<span style="color:#ff79c6">&gt;</span> stringIterator <span style="color:#ff79c6">=</span> configSourceContext.<span style="color:#50fa7b">iterateNames</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">while</span> (stringIterator.<span style="color:#50fa7b">hasNext</span>()) {
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">final</span> String key <span style="color:#ff79c6">=</span> stringIterator.<span style="color:#50fa7b">next</span>();
</span></span><span style="display:flex;"><span>      <span style="color:#8be9fd;font-style:italic">final</span> ConfigValue cValue <span style="color:#ff79c6">=</span> configSourceContext.<span style="color:#50fa7b">getValue</span>(key);
</span></span><span style="display:flex;"><span>      exProp.<span style="color:#50fa7b">put</span>(key, cValue);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> JsonConfigSource configSource <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> JsonConfigSource(exProp);
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">final</span> List<span style="color:#ff79c6">&lt;</span>ConfigValue<span style="color:#ff79c6">&gt;</span> configValueList <span style="color:#ff79c6">=</span> List.<span style="color:#50fa7b">of</span>(value);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">final</span> ConfigValue config : configValueList) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">if</span> (ConfigExists(config)) {
</span></span><span style="display:flex;"><span>        configSource.<span style="color:#50fa7b">addJsonConfigurations</span>(config);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> Collections.<span style="color:#50fa7b">singletonList</span>(configSource);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @Override
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">public</span> OptionalInt <span style="color:#50fa7b">getPriority</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> OptionalInt.<span style="color:#50fa7b">of</span>(270);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">ConfigExists</span>(<span style="color:#8be9fd;font-style:italic">final</span> ConfigValue config) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> (config <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">||</span> config.<span style="color:#50fa7b">getValue</span>() <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>      log.<span style="color:#50fa7b">warn</span>(<span style="color:#f1fa8c">&#34;The given ConfigValue object is null&#34;</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>(Files.<span style="color:#50fa7b">exists</span>(Path.<span style="color:#50fa7b">of</span>(config.<span style="color:#50fa7b">getValue</span>())))) {
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="registration-via-serviceloader">Registration via ServiceLoader</h3>
<p>Both the <code>JsonConfigSource</code> and <code>JsonConfigSourceFactory</code> are registered with the Quarkus
application through the Java ServiceLoader mechanism. A file
named <code>io.smallrye.config.ConfigSourceFactory</code> is placed in the <code>META-INF/services/</code> directory. This
file contains the fully qualified name of the <code>JsonConfigSourceFactory</code>, enabling Quarkus to
discover
and use it.</p>
<h3 id="the-json-file">The JSON file</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;simple.service&#34;</span>: <span style="color:#f1fa8c">&#34;pusher&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;simple.source&#34;</span>: <span style="color:#f1fa8c">&#34;source&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">&#34;simple.destination&#34;</span>: <span style="color:#f1fa8c">&#34;destination&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="define-your-configuration-interface">Define Your Configuration Interface</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@ConfigMapping(prefix <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;simple&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">interface</span> <span style="color:#50fa7b">SimpleConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @WithName(<span style="color:#f1fa8c">&#34;source&#34;</span>)
</span></span><span style="display:flex;"><span>  String <span style="color:#50fa7b">source</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @WithName(<span style="color:#f1fa8c">&#34;service&#34;</span>)
</span></span><span style="display:flex;"><span>  String <span style="color:#50fa7b">service</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  @WithName(<span style="color:#f1fa8c">&#34;destination&#34;</span>)
</span></span><span style="display:flex;"><span>  String <span style="color:#50fa7b">destination</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Eclipse MicroProfile Config, in conjunction with the SmallRye implementation, empowers Quarkus
developers to manage their application&rsquo;s configuration efficiently. The ability to create and
register custom <code>ConfigSources</code> and <code>ConfigSourceFactories</code>, as demonstrated with
the <code>JsonConfigSource</code>
and <code>JsonConfigSourceFactory</code>, extends the flexibility and utility of the framework. By following
these guidelines, you can seamlessly integrate external configuration data, such as JSON files, into
your Quarkus application, enhancing its configurability and adaptability.</p>
<p>By understanding these concepts and leveraging the power of MicroProfile Config, you can further
optimize your Quarkus application&rsquo;s configuration management and streamline the development process.</p>
<p>The full source code is available
at <a href="https://github.com/iqnev/quarkus-load-configuration-from-externa-json-file" title="Title">Github</a></p>

      
      <div class="post-date">
        <span class="g time">October 14, 2023 </span> &#8729;
         
         <a href="https://iqnev.github.io/tags/development/">development</a> <a href="https://iqnev.github.io/tags/quarkus/">quarkus</a> <a href="https://iqnev.github.io/tags/microprofile/">microprofile</a> <a href="https://iqnev.github.io/tags/json/">json</a>
      </div>
      
    </section>
    
    <div id="comments">
      <script src="https://utteranc.es/client.js"
    repo=ZgotmplZ
    issue-term="pathname"
    theme=github-light
    crossorigin="anonymous"
    async>
</script>

    </div>
    
  </div>
</main>
</body>
</html>
